<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Informe Gerencial de Calidad V.64 | Sistema Quijano</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>

    <style>
        :root {
            --c-dark: #0a1324;  /* Navy m√°s profundo */
            --c-blue: #1e40af;  /* Azul Institucional */
            --c-gold: #b45309;  /* Dorado Serio */
            --c-gray: #f8fafc;
            --risk: #dc2626; --warn: #d97706; --safe: #16a34a;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #e2e8f0;
            margin: 0;
            padding: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 40px;
            color: var(--c-dark);
        }

        /* --- ARQUITECTURA A4 BASE --- */
        .page {
            background: white;
            width: 21cm; height: 29.7cm; /* A4 Fijo por defecto */
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            box-sizing: border-box;
            display: flex; flex-direction: column;
            overflow: hidden; /* Mantiene el dise√±o compacto en pantalla */
        }

        /* --- P√ÅGINA 1: PORTADA (DEGRADADO PROFUNDO V.2) --- */
        .cover-page {
            /* 90% oscuro, 10% luz al final */
            background: linear-gradient(180deg, #0a1324 0%, #0a1324 85%, #1e3a8a 100%) !important;
            color: white; padding: 3cm; justify-content: center; text-align: center;
            -webkit-print-color-adjust: exact; print-color-adjust: exact;
        }
        .cover-logo { height: 140px; margin-bottom: 50px; filter: drop-shadow(0 10px 20px rgba(0,0,0,0.4)); }
        .cover-title { font-size: 48px; font-weight: 900; letter-spacing: -2px; line-height: 1; margin-bottom: 15px; }
        .cover-strip { width: 80px; height: 6px; background: var(--c-gold); margin: 0 auto 50px auto; border-radius: 3px; }
        .cover-sub { font-size: 18px; font-weight: 400; letter-spacing: 3px; text-transform: uppercase; opacity: 0.9; }
        .cover-footer { position: absolute; bottom: 2cm; left:0; right:0; font-size: 12px; opacity: 0.7; border-top: 1px solid rgba(255,255,255,0.2); padding-top: 20px; width: 80%; margin: auto; }

        /* --- P√ÅGINA 2: CARTA (SUBIDA) --- */
        .letter-page { padding: 2cm 2.5cm; } /* Menos padding superior */
        .letter-header { border-bottom: 3px solid var(--c-dark); padding-bottom: 20px; margin-bottom: 30px; }
        .letter-title { font-size: 22px; font-weight: 800; color: var(--c-blue); text-transform: uppercase; }
        
        /* Cuerpo de la carta subido */
        .letter-body-container { display: flex; flex-direction: column; justify-content: flex-start; flex-grow: 1; padding-top: 20px; }
        .letter-body { font-size: 14px; line-height: 2; text-align: justify; color: #334155; }
        .letter-body p { margin-bottom: 25px; }
        .signature-block { margin-top: auto; } 
        .sign-line { width: 250px; border-bottom: 2px solid #0f172a; margin-bottom: 15px; }

        /* --- P√ÅGINA 3: MATRIZ EL√ÅSTICA INTELIGENTE --- */
        .matrix-page { padding: 2cm; }
        .section-title { font-size: 20px; font-weight: 800; color: var(--c-dark); border-left: 6px solid var(--c-blue); padding-left: 15px; margin-bottom: 30px; text-transform: uppercase; }

        /* Contenedor que centra si es peque√±o, pero crece si es grande */
        .table-wrapper-elastic {
            flex-grow: 1; display: flex; flex-direction: column;
            justify-content: center; /* Centra verticalmente si hay pocos */
            min-height: 0; /* Permite scrolling/overflow */
        }

        .data-table { width: 100%; border-collapse: collapse; font-size: 11px; margin: auto 0; /* Ayuda al centrado */ }
        /* Encabezado pegajoso para impresi√≥n multip√°gina */
        .data-table thead { display: table-header-group; }
        .data-table th { background: var(--c-dark); color: white; padding: 12px; text-transform: uppercase; letter-spacing: 1px; }
        /* Evita partir filas al imprimir */
        .data-table tr { page-break-inside: avoid; }
        .data-table td { padding: 8px 8px; border-bottom: 1px solid #e2e8f0; text-align: center; vertical-align: middle; }
        .data-table tr:nth-child(even) { background: #f8fafc; }
        .col-name { text-align: left !important; font-weight: 700; font-size: 12px; }
        
        .row-total td { background: #e2e8f0; font-weight: 900; border-top: 3px solid var(--c-dark); font-size: 13px; padding: 15px 8px; }
        
        /* Heatmap Colors */
        .bg-crit { background: #fee2e2; color: var(--risk); font-weight:700; border-radius: 4px; padding: 4px 8px; }
        .bg-warn { background: #fef3c7; color: var(--warn); font-weight:700; border-radius: 4px; padding: 4px 8px; }
        .bg-good { background: #dcfce7; color: var(--safe); font-weight:700; border-radius: 4px; padding: 4px 8px; }

        /* --- P√ÅGINA 4: GR√ÅFICAS (COLORES L√ìGICOS + DONUT CENTRADO) --- */
        .charts-page { padding: 2cm; }
        .charts-container { flex-grow: 1; display: flex; flex-direction: column; gap: 40px; justify-content: center; }
        .chart-box { background: white; border-radius: 16px; padding: 25px; box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.08); border: 1px solid #f1f5f9; }
        .chart-heading { text-align: center; font-weight: 800; margin-bottom: 20px; color: var(--c-blue); text-transform: uppercase; font-size: 14px; }

        /* Donut 3D Centrado Perfecto */
        .donut-wrapper { 
            position: relative; height: 320px; /* Un poco m√°s alto */
            display: flex; justify-content: center; align-items: center;
            border-radius: 50%;
            box-shadow: inset 0 0 40px rgba(0,0,0,0.1), 0 25px 50px rgba(0,0,0,0.25); /* Sombra m√°s profunda */
            width: 320px; margin: 0 auto; background: white; padding: 15px;
            box-sizing: border-box;
        }
        /* El canvas debe llenar el wrapper */
        .donut-wrapper canvas { z-index: 1; }
        .donut-center-txt { 
            position: absolute; text-align: center; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 2;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            height: 100px; width: 100px; /* Asegura centrado */
        }

        /* --- P√ÅGINA 5: DICTAMEN (MULTICOLOR Y LLENO) --- */
        .analysis-page { padding: 2cm; justify-content: space-between; }
        .analysis-container { flex-grow: 1; display: flex; flex-direction: column; gap: 20px; /* Espacio uniforme */ justify-content: flex-start; margin-top: 20px; }
        
        .analysis-item { 
            background: #f8fafc; 
            padding: 25px; border-radius: 0 12px 12px 0; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.03);
        }
        /* Variaci√≥n de colores por caja */
        .item-lec { border-left: 6px solid var(--c-blue); }
        .item-mat { border-left: 6px solid var(--c-dark); }
        .item-ing { border-left: 6px solid var(--c-gold); }
        .item-final { border-left: 6px solid var(--safe); background: #f0fdf4; } /* Caja Verde final */

        .analysis-item h3 { margin: 0 0 15px 0; font-size: 15px; color: var(--c-dark); text-transform: uppercase; font-weight: 800; }
        .analysis-text { font-size: 13px; line-height: 1.8; color: #475569; text-align: justify; margin: 0; }

        .footer-strip-large { 
            text-align: center; font-size: 12px; color: #64748b; 
            border-top: 2px solid #e2e8f0; padding-top: 30px; margin-top: auto;
            font-weight: 500; letter-spacing: 1px;
        }

        /* --- IMPRESI√ìN PERFECTA (La Clave de la Matriz) --- */
        @media print {
            @page { margin: 0; size: A4; }
            body { background: white; padding: 0; gap: 0; }
            
            /* P√°ginas est√°ndar */
            .page { 
                margin: 0; width: 21cm; height: 29.7cm; /* Altura fija normal */
                box-shadow: none; page-break-after: always; break-inside: avoid;
                overflow: hidden;
            }

            /* EXCEPCI√ìN: La p√°gina de la matriz puede crecer */
            .matrix-page { 
                height: auto !important; /* Permite que crezca */
                min-height: 29.7cm; 
                overflow: visible !important; /* Permite que fluya a otra hoja */
            }

            .page:last-child { page-break-after: auto; }
            .fab-print { display: none; }
            * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
        }

        .fab-print { position: fixed; bottom: 30px; right: 30px; background: var(--c-blue); color: white; padding: 15px 40px; border-radius: 50px; font-weight: 800; cursor: pointer; border: none; box-shadow: 0 10px 25px rgba(29, 78, 216, 0.5); z-index: 999; font-size: 14px; }
    </style>
</head>
<body>

    <div class="page cover-page">
        <div>
            <img src="https://raw.githubusercontent.com/profeangel96-bit/PLANTILLA/main/Gemini_Generated_Image_24c84124c84124c8.png" class="cover-logo">
            <div class="cover-title">INFORME GERENCIAL<br>DE CALIDAD EDUCATIVA</div>
            <div class="cover-strip"></div>
            <div class="cover-sub">EVALUACI√ìN ESTRAT√âGICA | SIMULACRO S-11</div>
        </div>
        <div class="cover-footer">
            DOCUMENTO OFICIAL GENERADO POR SISTEMA DE INTELIGENCIA QUIJANO<br>
            CONFIDENCIAL ‚Ä¢ PARA USO EXCLUSIVO DE ALCALD√çA Y RECTOR√çA
        </div>
    </div>

    <div class="page letter-page">
        <div class="letter-header">
            <div class="letter-title">Radicado N¬∞ <span id="rad-id">AQ-2026-001</span></div>
            <div style="text-align: right; font-size: 12px; color: #64748b;">
                <strong>FECHA DE EMISI√ìN:</strong><br>16 de Enero de 2026
            </div>
        </div>
        
        <div class="letter-body-container">
            <div class="letter-body">
                <p><strong>HONORABLE ALCALD√çA MUNICIPAL Y SECRETAR√çA DE EDUCACI√ìN:</strong></p>
                <p>
                    En calidad de consultores externos especializados en medici√≥n y evaluaci√≥n educativa, 
                    la <strong>Academia Quijano</strong> hace entrega formal del presente dictamen t√©cnico 
                    correspondiente a la prueba diagn√≥stica (Simulacro S-11) aplicada a la poblaci√≥n de grado und√©cimo.
                </p>
                <p>
                    El siguiente informe no constituye un simple listado de calificaciones. Representa un an√°lisis 
                    de inteligencia de datos dise√±ado para identificar brechas de aprendizaje estructurales, 
                    evaluar la eficacia de los procesos docentes actuales y proporcionar una hoja de ruta 
                    basada en evidencia cuantitativa para la toma de decisiones directivas.
                </p>
                <p>Quedamos a su entera disposici√≥n para la socializaci√≥n de estos hallazgos estrat√©gicos.</p>
            </div>
        </div>

        <div class="signature-block">
            <div class="sign-line"></div>
            <strong>JUAN √ÅNGEL RODR√çGUEZ BASANTE</strong><br>
            <span style="font-size: 12px; color: #64748b; font-weight: 500;">Director General de Operaciones<br>Sistema de Inteligencia Quijano</span>
        </div>
    </div>

    <div class="page matrix-page">
        <div class="section-title">Matriz Consolidada de Desempe√±o (Heatmap)</div>

        <div class="table-wrapper-elastic">
            <table class="data-table">
                <thead>
                    <tr>
                        <th style="width: 40px;">#</th>
                        <th>Estudiante Evaluado</th>
                        <th style="width: 70px;">LEC</th>
                        <th style="width: 70px;">MAT</th>
                        <th style="width: 70px;">SOC</th>
                        <th style="width: 70px;">CIE</th>
                        <th style="width: 70px;">ING</th>
                        <th style="width: 80px;">GLOBAL</th>
                    </tr>
                </thead>
                <tbody id="table-body">
                    </tbody>
                <tfoot>
                    <tr class="row-total" id="table-footer">
                        </tr>
                </tfoot>
            </table>
        </div>
        
        <div style="margin-top: 20px; font-size: 10px; color: #64748b; text-align: center;">
            * Convenci√≥n: <span class="bg-crit" style="font-size:9px;">0-45 Cr√≠tico</span> | <span class="bg-warn" style="font-size:9px;">46-65 Alerta</span> | <span class="bg-good" style="font-size:9px;">66-100 √ìptimo</span>.
            La matriz se expandir√° autom√°ticamente en p√°ginas subsiguientes si el volumen de datos lo requiere.
        </div>
    </div>

    <div class="page charts-page">
        <div class="section-title">Indicadores Visuales de Gesti√≥n Acad√©mica</div>

        <div class="charts-container">
            <div class="chart-box">
                <div class="chart-heading">Ranking de Desempe√±o Promedio por Asignatura</div>
                <div style="height: 280px;">
                    <canvas id="barChart"></canvas>
                </div>
            </div>

            <div class="chart-box" style="display: flex; flex-direction: column; align-items: center;">
                <div class="chart-heading">Distribuci√≥n Poblacional por Niveles de Competencia</div>
                <div class="donut-wrapper">
                    <canvas id="donutChart"></canvas>
                    <div class="donut-center-txt">
                        <div style="font-size: 36px; font-weight: 900; color: var(--c-dark);" id="total-students">0</div>
                        <div style="font-size: 11px; color: #64748b; text-transform: uppercase;">Estudiantes</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="page analysis-page">
        <div class="section-title">Dictamen T√©cnico Descriptivo Final</div>

        <div class="analysis-container">
            <div class="analysis-item item-lec">
                <h3>1. Hallazgos en Componente Lector y Comunicativo</h3>
                <p class="analysis-text" id="desc-lec">
                    El an√°lisis evidencia que la media aritm√©tica en Lectura Cr√≠tica es de <span id="avg-lec-txt" style="font-weight:700">0</span> puntos. 
                    Se observa una dispersi√≥n moderada, sugiriendo niveles heterog√©neos de apropiaci√≥n de la competencia inferencial que requieren estrategias diferenciadas en el aula.
                </p>
            </div>

            <div class="analysis-item item-mat">
                <h3>2. Hallazgos en Razonamiento Cuantitativo y Cient√≠fico</h3>
                <p class="analysis-text" id="desc-mat">
                    Las √°reas de Matem√°ticas y Ciencias presentan los mayores retos. 
                    El promedio de Matem√°ticas (<span id="avg-mat-txt" style="font-weight:700;">0</span>) indica una tendencia hacia el rango inferior, 
                    demandando una revisi√≥n inmediata de las metodolog√≠as de resoluci√≥n de problemas aplicados.
                </p>
            </div>

            <div class="analysis-item item-ing">
                <h3>3. Desempe√±o en Segunda Lengua (Ingl√©s)</h3>
                <p class="analysis-text" id="desc-ing">
                    El componente de Ingl√©s muestra estabilidad en la banda media, con un promedio de <span id="avg-ing-txt" style="font-weight:700">0</span>. 
                    La mayor√≠a de la poblaci√≥n demuestra dominio de las competencias b√°sicas del marco de referencia A1/A2.
                </p>
            </div>

            <div class="analysis-item item-final">
                <h3>4. Proyecci√≥n y Recomendaci√≥n Estrat√©gica</h3>
                <p class="analysis-text">
                    Con base en los datos, la instituci√≥n posee un potencial de mejora del 15% en el √≠ndice global si se focalizan esfuerzos en el 
                    fortalecimiento del razonamiento cuantitativo del cuartil medio. Se recomienda implementar un plan de choque de 8 semanas 
                    previo a la prueba de estado real.
                </p>
            </div>
        </div>

        <div class="footer-strip-large">
            FIN DEL INFORME T√âCNICO ‚Ä¢ CERTIFICADO DE CALIDAD ISO 9001 ‚Ä¢ SISTEMA QUIJANO V.64
        </div>
    </div>

    <button class="fab-print" onclick="window.print()">üñ®Ô∏è IMPRIMIR INFORME OFICIAL</button>

    <script>
        // --- SIMULACI√ìN DE DATOS (SE LLENAR√ÅN 30 PARA PROBAR LA TABLA GRANDE) ---
        const baseStudents = [
            { name: "AGUIRRE DAVILA DANA", l: 71, m: 68, s: 70, c: 75, i: 80, g: 364 },
            { name: "ANACONA BOLA√ëOS ANDRES", l: 65, m: 45, s: 60, c: 55, i: 45, g: 270 },
            { name: "ARCOS NANDAR OSCAR", l: 40, m: 30, s: 45, c: 50, i: 35, g: 200 },
            { name: "BENAVIDES SOFIA", l: 82, m: 78, s: 75, c: 80, i: 85, g: 400 },
            { name: "CAICEDO JUAN ESTEBAN", l: 55, m: 45, s: 50, c: 52, i: 40, g: 242 }
        ];
        // Multiplicamos por 6 para tener 30 alumnos y ver c√≥mo se comporta la tabla
        let students = [];
        for(let k=0; k<6; k++) {
            students = students.concat(baseStudents.map((s, i) => ({...s, name: s.name + " " + (k+1)})));
        }

        // --- L√ìGICA TABLA Y TOTALES ---
        const tbody = document.getElementById('table-body');
        let sum = { l:0, m:0, s:0, c:0, i:0, g:0 };
        function getColor(v) { if(v<=45) return 'bg-crit'; if(v<=65) return 'bg-warn'; return 'bg-good'; }

        students.forEach((s, i) => {
            sum.l+=s.l; sum.m+=s.m; sum.s+=s.s; sum.c+=s.c; sum.i+=s.i; sum.g+=s.g;
            tbody.innerHTML += `<tr>
                <td>${i+1}</td><td class="col-name">${s.name}</td>
                <td><span class="${getColor(s.l)}">${s.l}</span></td><td><span class="${getColor(s.m)}">${s.m}</span></td>
                <td><span class="${getColor(s.s)}">${s.s}</span></td><td><span class="${getColor(s.c)}">${s.c}</span></td>
                <td><span class="${getColor(s.i)}">${s.i}</span></td><td><strong>${s.g}</strong></td>
            </tr>`;
        });

        const count = students.length;
        const avg = { l:Math.round(sum.l/count), m:Math.round(sum.m/count), s:Math.round(sum.s/count), c:Math.round(sum.c/count), i:Math.round(sum.i/count), g:Math.round(sum.g/count) };

        document.getElementById('table-footer').innerHTML = `
            <td colspan="2" style="text-align:right; letter-spacing:1px;">PROMEDIO INSTITUCIONAL:</td>
            <td class="${getColor(avg.l)}">${avg.l}</td><td class="${getColor(avg.m)}">${avg.m}</td>
            <td class="${getColor(avg.s)}">${avg.s}</td><td class="${getColor(avg.c)}">${avg.c}</td>
            <td class="${getColor(avg.i)}">${avg.i}</td><td style="font-size:14px;">${avg.g}</td>
        `;

        // Actualizar Textos
        document.getElementById('total-students').innerText = count;
        document.getElementById('avg-lec-txt').innerText = avg.l;
        document.getElementById('avg-mat-txt').innerText = avg.m;
        document.getElementById('avg-ing-txt').innerText = avg.i;
        document.getElementById('avg-mat-txt').style.color = avg.m <= 65 ? 'var(--risk)' : 'inherit';

        // --- GR√ÅFICOS INTELIGENTES (COLORES DIN√ÅMICOS) ---
        Chart.defaults.font.family = "'Inter', sans-serif";
        
        // Funci√≥n para asignar color de barra seg√∫n el promedio
        function getBarColor(val) {
             if(val <= 60) return '#dc2626'; // Rojo Risk
             if(val <= 75) return '#d97706'; // Dorado Warn
             return '#1d4ed8'; // Azul Safe/Corporate
        }

        // 1. Barras con Colores L√≥gicos
        new Chart(document.getElementById('barChart'), {
            type: 'bar',
            data: {
                labels: ['LECTURA', 'SOCIALES', 'CIENCIAS', 'INGL√âS', 'MATEM√ÅTICAS'],
                datasets: [{
                    data: [avg.l, avg.s, avg.c, avg.i, avg.m],
                    backgroundColor: [ getBarColor(avg.l), getBarColor(avg.s), getBarColor(avg.c), getBarColor(avg.i), getBarColor(avg.m) ],
                    borderRadius: 6, barPercentage: 0.6
                }]
            },
            options: {
                indexAxis: 'y', plugins: { legend: false },
                scales: { x: { beginAtZero:true, max:100, grid:{color:'#e2e8f0'} }, y: { grid:{display:false}, ticks:{font:{weight:'700'}} } }
            }
        });

        // 2. Donut 3D Profundo
        let levels = { low:0, mid:0, high:0 }; students.forEach(s=>{ if(s.g<250) levels.low++; else if(s.g<320) levels.mid++; else levels.high++; });
        new Chart(document.getElementById('donutChart'), {
            type: 'doughnut',
            data: {
                labels: ['Bajo', 'Medio', 'Alto'],
                datasets: [{
                    data: [levels.low, levels.mid, levels.high],
                    backgroundColor: ['#dc2626', '#f59e0b', '#16a34a'],
                    borderWidth: 5, borderColor: '#ffffff', hoverOffset: 15
                }]
            },
            options: { cutout: '75%', plugins: { legend: { position:'bottom', labels:{padding:20, usePointStyle:true, font:{weight:'600'}} } } }
        });

        const p = new URLSearchParams(window.location.search);
        if(p.get('rad')) document.getElementById('rad-id').innerText = p.get('rad');
    </script>
</body>
</html>
