<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Informe Gerencial | Quijano Intelligence</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --navy: #0f172a;
            --blue: #2563eb;
            --gold: #d97706;
            --risk: #ef4444;
            --safe: #10b981;
            --bg: #f8fafc;
            --card-bg: #ffffff;
            --shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #e2e8f0;
            margin: 0;
            padding: 40px;
            display: flex;
            justify-content: center;
            color: var(--navy);
            -webkit-print-color-adjust: exact;
        }

        /* --- CONTENEDOR TIPO HOJA A4 (Dashboard) --- */
        .dashboard-page {
            background: var(--card-bg);
            width: 21cm;
            min-height: 29.7cm;
            padding: 1.5cm;
            box-shadow: var(--shadow);
            display: grid;
            grid-template-rows: auto auto 1fr auto auto; /* Header, IA, Heatmap/Radar, Footer */
            gap: 30px;
            box-sizing: border-box;
            border-radius: 12px; /* Toque App */
        }

        /* 1. HEADER EJECUTIVO */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 20px;
        }
        .brand h1 { margin: 0; font-size: 22px; font-weight: 800; letter-spacing: -0.5px; color: var(--navy); }
        .brand span { color: var(--blue); }
        .report-meta { text-align: right; }
        .pill { 
            background: #eff6ff; color: var(--blue); 
            padding: 6px 12px; border-radius: 20px; 
            font-size: 11px; font-weight: 700; text-transform: uppercase;
        }

        /* 2. TARJETA DE INTELIGENCIA ARTIFICIAL (IA INSIGHTS) */
        .ai-card {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: white;
            border-radius: 12px;
            padding: 25px;
            display: flex;
            gap: 20px;
            box-shadow: 0 8px 20px rgba(15, 23, 42, 0.25);
            align-items: center;
        }
        .ai-icon { font-size: 32px; }
        .ai-content h3 { margin: 0 0 5px 0; font-size: 14px; color: var(--gold); text-transform: uppercase; letter-spacing: 1px; }
        .ai-content p { margin: 0; font-size: 13px; opacity: 0.9; line-height: 1.5; font-weight: 300; }

        /* 3. GRID CENTRAL: RADAR + HEATMAP */
        .analytics-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        /* Radar Chart (3D Feel) */
        .chart-container {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 15px;
            position: relative;
        }
        .section-title { font-size: 14px; font-weight: 700; margin-bottom: 15px; color: var(--navy); display: flex; align-items: center; gap: 8px; }
        .section-title::before { content: ''; width: 4px; height: 16px; background: var(--blue); border-radius: 2px; display: block; }

        /* HEATMAP (Mapa de Calor) */
        .heatmap-container {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 15px;
            overflow: hidden;
        }
        .heatmap-table { width: 100%; border-collapse: collapse; font-size: 11px; }
        .heatmap-table th { text-align: left; color: #64748b; font-weight: 600; padding: 8px; border-bottom: 1px solid #e2e8f0; }
        .heatmap-table td { padding: 8px; border-bottom: 1px solid #f1f5f9; font-weight: 500; }
        
        /* Celdas del Mapa de Calor (Puntos de color) */
        .heat-cell { 
            width: 30px; height: 30px; 
            border-radius: 6px; 
            display: flex; align-items: center; justify-content: center;
            color: white; font-weight: 700; font-size: 10px;
        }
        .level-low { background: var(--risk); box-shadow: 0 2px 5px rgba(239, 68, 68, 0.3); } /* Rojo */
        .level-mid { background: #f59e0b; } /* Naranja */
        .level-high { background: var(--safe); box-shadow: 0 2px 5px rgba(16, 185, 129, 0.3); } /* Verde */

        /* 4. CERTIFICADO DE AUTENTICIDAD */
        .certificate-block {
            border: 2px dashed #cbd5e1;
            background: #f8fafc;
            border-radius: 8px;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
        }
        .cert-text { font-size: 10px; color: #64748b; max-width: 60%; }
        .qr-placeholder {
            width: 60px; height: 60px; background: white; border: 1px solid #e2e8f0;
            display: flex; align-items: center; justify-content: center; font-size: 24px;
            border-radius: 4px;
        }

        /* BOT√ìN IMPRIMIR */
        .fab {
            position: fixed; bottom: 30px; right: 30px;
            background: var(--navy); color: white;
            border: none; padding: 15px 30px; border-radius: 50px;
            font-weight: 700; cursor: pointer;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            transition: transform 0.2s;
        }
        .fab:hover { transform: scale(1.05); }

        /* --- MODO IMPRESI√ìN PRO --- */
        @media print {
            body { background: white; padding: 0; }
            .dashboard-page { box-shadow: none; width: 100%; margin: 0; padding: 1.5cm; border-radius: 0; }
            .fab { display: none; }
            .ai-card { background: #0f172a !important; color: white !important; -webkit-print-color-adjust: exact; }
            .heat-cell { -webkit-print-color-adjust: exact; }
        }
    </style>
</head>
<body>

    <div class="dashboard-page">
        <header>
            <div class="brand">
                <h1>SISTEMA <span>QUIJANO</span></h1>
                <div style="font-size: 11px; color: #64748b; letter-spacing: 1px;">PLATAFORMA DE INTELIGENCIA EDUCATIVA</div>
            </div>
            <div class="report-meta">
                <div class="pill" id="sim-display">SIMULACRO S-11</div>
                <div style="font-size: 12px; margin-top: 5px; font-weight: 600;" id="muni-display">MUNICIPIO</div>
                <div style="font-size: 10px; color: #94a3b8;">16 ENE 2026</div>
            </div>
        </header>

        <div class="ai-card">
            <div class="ai-icon">üß†</div>
            <div class="ai-content">
                <h3>Direcci√≥n Estrat√©gica Detectada</h3>
                <p id="ai-text">
                    Analizando 5 variables clave: Se recomienda priorizar intervenci√≥n en <strong>Razonamiento Cuantitativo</strong>. 
                    El 15% del grupo muestra potencial de excelencia si se refuerzan competencias lectoras inferenciales. 
                    <br><em>Acci√≥n sugerida: Activar protocolo de refuerzo T-2.</em>
                </p>
            </div>
        </div>

        <div class="analytics-grid">
            
            <div class="chart-container">
                <div class="section-title">SIMETR√çA DEL CONOCIMIENTO</div>
                <div style="height: 250px;">
                    <canvas id="radarChart"></canvas>
                </div>
                <div style="text-align: center; font-size: 10px; color: #64748b; margin-top: 10px;">
                    <span style="color: rgba(37, 99, 235, 1);">‚óè Instituci√≥n</span> &nbsp;|&nbsp; 
                    <span style="color: #94a3b8;">‚óè Promedio Nacional</span>
                </div>
            </div>

            <div class="heatmap-container">
                <div class="section-title">MAPA T√âRMICO DE RENDIMIENTO</div>
                <p style="font-size: 10px; color: #64748b; margin-bottom: 10px;">
                    Visualizaci√≥n r√°pida de fallas sist√©micas. <span style="color:var(--risk)">Rojo = Riesgo</span>.
                </p>
                
                <table class="heatmap-table">
                    <thead>
                        <tr>
                            <th>√Årea</th>
                            <th>Puntaje</th>
                            <th>Estado</th>
                        </tr>
                    </thead>
                    <tbody id="heatmap-body">
                        <tr><td>Lectura</td><td><div class="heat-cell level-high" id="hm-lec">0</div></td><td>S√≥lido</td></tr>
                        <tr><td>Matem√°ticas</td><td><div class="heat-cell level-low" id="hm-mat">0</div></td><td>Cr√≠tico</td></tr>
                        <tr><td>Sociales</td><td><div class="heat-cell level-mid" id="hm-soc">0</div></td><td>Medio</td></tr>
                        <tr><td>Ciencias</td><td><div class="heat-cell level-mid" id="hm-cie">0</div></td><td>Medio</td></tr>
                        <tr><td>Ingl√©s</td><td><div class="heat-cell level-high" id="hm-ing">0</div></td><td>S√≥lido</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;">
            <div style="background:#f8fafc; padding:15px; border-radius:8px; text-align:center;">
                <div style="font-size:10px; color:#64748b; text-transform:uppercase;">Promedio Global</div>
                <div style="font-size:32px; font-weight:800; color:var(--navy);" id="kpi-avg">0</div>
            </div>
            <div style="background:#f8fafc; padding:15px; border-radius:8px; text-align:center;">
                <div style="font-size:10px; color:#64748b; text-transform:uppercase;">Excelencia</div>
                <div style="font-size:32px; font-weight:800; color:var(--safe);" id="kpi-exc">0%</div>
            </div>
            <div style="background:#f8fafc; padding:15px; border-radius:8px; text-align:center;">
                <div style="font-size:10px; color:#64748b; text-transform:uppercase;">Riesgo</div>
                <div style="font-size:32px; font-weight:800; color:var(--risk);" id="kpi-ini">0%</div>
            </div>
        </div>

        <div class="certificate-block">
            <div class="cert-text">
                <strong>CERTIFICADO DE AUTENTICIDAD DE DATOS</strong><br>
                Este informe ha sido generado por el motor de inteligencia de Academia Quijano. 
                Los datos aqu√≠ presentados son inalterables y corresponden a la prueba identificada.
                <br><br>
                <span style="font-family: monospace;" id="v-code">HASH: ---</span>
            </div>
            <div class="qr-placeholder">üèÅ</div>
        </div>

    </div>

    <button class="fab" onclick="window.print()">üñ®Ô∏è IMPRIMIR REPORTE</button>

    <script>
        // --- 1. CAPTURA DE DATOS (URL) ---
        const p = new URLSearchParams(window.location.search);
        
        // Textos B√°sicos
        document.getElementById('muni-display').innerText = (p.get('muni') || 'MUNICIPIO').toUpperCase();
        document.getElementById('sim-display').innerText = p.get('sim') || 'SIMULACRO';
        document.getElementById('v-code').innerText = "HASH: " + (p.get('v') || 'NO-DATA');

        // Datos Num√©ricos
        const lec = parseInt(p.get('lec')||0);
        const mat = parseInt(p.get('mat')||0);
        const soc = parseInt(p.get('soc')||0);
        const cie = parseInt(p.get('cie')||0);
        const ing = parseInt(p.get('ing')||0);
        const avg = p.get('avg')||0;

        document.getElementById('kpi-avg').innerText = avg;
        document.getElementById('kpi-exc').innerText = (p.get('exc')||0) + "%";
        document.getElementById('kpi-ini').innerText = (p.get('ini')||0) + "%";

        // --- 2. L√ìGICA DEL HEATMAP (Incendio Acad√©mico) ---
        function updateHeatmap(id, val) {
            const el = document.getElementById(id);
            el.innerText = val;
            el.className = 'heat-cell'; // reset
            if(val < 50) el.classList.add('level-low');
            else if(val < 70) el.classList.add('level-mid');
            else el.classList.add('level-high');
        }
        updateHeatmap('hm-lec', lec);
        updateHeatmap('hm-mat', mat);
        updateHeatmap('hm-soc', soc);
        updateHeatmap('hm-cie', cie);
        updateHeatmap('hm-ing', ing);

        // --- 3. L√ìGICA DEL RADAR 3D (Contrastado) ---
        const ctx = document.getElementById('radarChart').getContext('2d');
        Chart.defaults.font.family = "'Inter', sans-serif";
        
        new Chart(ctx, {
            type: 'radar',
            data: {
                labels: ['LECTURA', 'MATEM√ÅTICAS', 'SOCIALES', 'CIENCIAS', 'INGL√âS'],
                datasets: [
                    {
                        label: 'Instituci√≥n',
                        data: [lec, mat, soc, cie, ing],
                        backgroundColor: 'rgba(37, 99, 235, 0.25)', // Azul transparente
                        borderColor: '#2563eb',
                        borderWidth: 3,
                        pointBackgroundColor: '#ffffff',
                        pointBorderColor: '#2563eb',
                        pointRadius: 5,
                        zIndex: 2 // Arriba
                    },
                    {
                        label: 'Nacional (Ref)',
                        data: [52, 48, 55, 50, 45], // Datos est√°ticos de referencia nacional
                        backgroundColor: 'rgba(148, 163, 184, 0.1)', // Gris muy suave
                        borderColor: '#94a3b8',
                        borderWidth: 1,
                        pointRadius: 0,
                        borderDash: [5, 5], // L√≠nea punteada
                        zIndex: 1 // Abajo (Sombra)
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    r: {
                        angleLines: { color: '#f1f5f9' },
                        grid: { color: '#f1f5f9' },
                        pointLabels: { font: { size: 10, weight: '700' }, color: '#64748b' },
                        ticks: { display: false, backdropColor: 'transparent' }
                    }
                },
                plugins: { legend: { display: false } }
            }
        });
    </script>
</body>
</html>
