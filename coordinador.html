<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Informe Maestro V.71 | Sistema Quijano</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>

    <style>
        :root {
            --c-dark: #0f172a; --c-blue: #1d4ed8; --c-gold: #b45309;
            --risk: #dc2626; --warn: #d97706; --safe: #16a34a;
            --shadow-pro: 0 10px 30px -5px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #e2e8f0;
            margin: 0; padding: 40px;
            display: flex; flex-direction: column; align-items: center; gap: 40px;
            color: var(--c-dark);
        }

        /* --- ARQUITECTURA TAMA√ëO CARTA (21.59 x 27.94 cm) --- */
        .page {
            background: white; width: 21.59cm; height: 27.94cm; 
            box-shadow: var(--shadow-pro); box-sizing: border-box;
            display: flex; flex-direction: column; overflow: hidden; position: relative;
        }

        /* --- P√ÅGINA 1: PORTADA --- */
        .cover-page {
            background: linear-gradient(180deg, #0f172a 0%, #0f172a 85%, #1e3a8a 100%) !important;
            color: white; padding: 3cm; justify-content: center; text-align: center;
            -webkit-print-color-adjust: exact; print-color-adjust: exact;
        }
        .cover-logo { height: 140px; margin-bottom: 50px; filter: drop-shadow(0 10px 20px rgba(0,0,0,0.4)); }
        .cover-title { font-size: 46px; font-weight: 900; letter-spacing: -2px; line-height: 1; margin-bottom: 15px; }
        .cover-strip { width: 80px; height: 6px; background: var(--c-gold); margin: 0 auto 50px auto; border-radius: 3px; }
        .cover-sub { font-size: 16px; font-weight: 400; letter-spacing: 3px; text-transform: uppercase; opacity: 0.9; }
        .cover-footer { position: absolute; bottom: 2cm; left:0; right:0; font-size: 11px; opacity: 0.7; border-top: 1px solid rgba(255,255,255,0.2); padding-top: 20px; width: 80%; margin: auto; }

        /* --- P√ÅGINA 2: CARTA --- */
        .letter-page { padding: 2.5cm; }
        .letter-header { border-bottom: 3px solid var(--c-dark); padding-bottom: 20px; margin-bottom: 30px; }
        .letter-title { font-size: 20px; font-weight: 800; color: var(--c-blue); text-transform: uppercase; }
        .letter-body-container { display: flex; flex-direction: column; justify-content: center; flex-grow: 1; padding-bottom: 10%; }
        .letter-body { font-size: 13px; line-height: 2; text-align: justify; color: #334155; }
        .letter-body p { margin-bottom: 20px; }
        .signature-block { margin-top: auto; }
        .sign-line { width: 250px; border-bottom: 2px solid #0f172a; margin-bottom: 15px; }

        /* --- P√ÅGINA 3+: MATRIZ (AJUSTES FINALES V.71) --- */
        .matrix-page { 
            padding: 2cm; 
            height: auto !important; 
            min-height: 27.94cm; 
            display: block; 
        } 
        
        /* 1. T√çTULO M√ÅS PEGADO A LA TABLA (Margin-bottom reducido a 10px) */
        .section-title { 
            font-size: 18px; font-weight: 800; color: var(--c-dark); 
            border-left: 6px solid var(--c-blue); padding-left: 15px; 
            margin-bottom: 10px; /* ANTES 30px, AHORA 10px */
            text-transform: uppercase; 
        }

        .data-table { width: 100%; border-collapse: collapse; font-size: 10px; margin-bottom: 20px; margin-top: 0; }
        
        /* HEADER REPETIDO + SALTO LIMPIO */
        .data-table thead { display: table-header-group; } 
        .data-table tr { page-break-inside: avoid !important; break-inside: avoid !important; } 
        
        /* Espaciador Invisible para nuevas p√°ginas */
        .print-spacer th { 
            height: 0px; 
            border: none !important; background: transparent !important; 
            padding: 0 !important;
        }

        .data-table th { background: var(--c-dark); color: white; padding: 10px 5px; text-transform: uppercase; letter-spacing: 0.5px; font-size: 9px; }
        .data-table td { padding: 8px 5px; border-bottom: 1px solid #e2e8f0; text-align: center; color: #334155; }
        .data-table tr:nth-child(even) { background: #f8fafc; }
        
        .final-row-total td { background: #e2e8f0; font-weight: 900; border-top: 3px solid var(--c-dark); font-size: 12px; padding: 15px 5px; }

        .bg-crit { background: #fee2e2; color: var(--risk); font-weight:700; border-radius: 4px; padding: 3px 0; display:block; width: 80%; margin: 0 auto; }
        .bg-warn { background: #ffedd5; color: #c2410c; font-weight:700; border-radius: 4px; padding: 3px 0; display:block; width: 80%; margin: 0 auto; }
        .bg-good { background: #dcfce7; color: var(--safe); font-weight:700; border-radius: 4px; padding: 3px 0; display:block; width: 80%; margin: 0 auto; }

        /* --- P√ÅGINA 4: GR√ÅFICAS --- */
        .charts-page { padding: 2cm; display: flex; flex-direction: column; justify-content: center; gap: 50px; }
        .chart-box { 
            background: white; border-radius: 12px; padding: 30px; 
            box-shadow: var(--shadow-pro); border: 1px solid #f1f5f9;
            border-left: 6px solid var(--c-blue);
            background: linear-gradient(to right, #f8fafc, #ffffff 10%);
        }
        .chart-heading { text-align: center; font-weight: 800; margin-bottom: 25px; color: var(--c-blue); text-transform: uppercase; font-size: 13px; letter-spacing: 1px; }
        .donut-simple-container { position: relative; height: 350px; width: 100%; display: flex; justify-content: center; align-items: center; }
        .donut-center-txt { position: absolute; text-align: center; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 2; }

        /* --- P√ÅGINA 5: DICTAMEN --- */
        .analysis-page { padding: 2cm; justify-content: space-between; }
        .analysis-container { flex-grow: 1; display: flex; flex-direction: column; gap: 30px; justify-content: center; margin: 20px 0; }
        .analysis-item { background: #fff; border: 1px solid #e2e8f0; padding: 20px 25px; border-radius: 8px; border-left: 6px solid; box-shadow: var(--shadow-pro); }
        .analysis-item h3 { margin: 0 0 10px 0; font-size: 15px; color: var(--c-dark); text-transform: uppercase; font-weight: 800; }
        .analysis-text { font-size: 13px; line-height: 1.8; color: #475569; text-align: justify; margin: 0; }
        .bor-lec { border-left-color: var(--c-blue); } .bor-mat { border-left-color: var(--risk); }
        .bor-soc { border-left-color: var(--warn); } .bor-cie { border-left-color: var(--safe); }
        .bor-ing { border-left-color: var(--c-gold); }
        .legal-footer { text-align: center; font-size: 10px; color: #94a3b8; border-top: 1px solid #e2e8f0; padding-top: 15px; margin-top: auto; font-family: monospace; letter-spacing: 0.5px; }

        /* --- MODO IMPRESI√ìN (AJUSTES DE SEGURIDAD) --- */
        @media print {
            @page { margin: 0; size: Letter; } 
            body { background: white; padding: 0; gap: 0; }
            .page { 
                margin: 0; width: 21.59cm; height: 27.94cm; 
                box-shadow: none; page-break-after: always; break-inside: avoid; overflow: hidden;
            }
            
            /* 2. FRENO DE SEGURIDAD INFERIOR AUMENTADO */
            .matrix-page { 
                height: auto !important; min-height: 27.94cm; 
                overflow: visible !important; 
                padding-bottom: 3.5cm !important; /* M√ÅS ESPACIO AL FINAL PARA EVITAR BORDES */
            }

            .print-spacer th { height: 1.5cm !important; }

            .page:last-child { page-break-after: auto; }
            .fab-print { display: none; }
            * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
        }

        .fab-print { position: fixed; bottom: 30px; right: 30px; background: var(--c-blue); color: white; padding: 15px 40px; border-radius: 50px; font-weight: 800; cursor: pointer; border: none; box-shadow: 0 10px 25px rgba(29, 78, 216, 0.5); z-index: 999; }
    </style>
</head>
<body>

    <div class="page cover-page">
        <div>
            <img src="https://raw.githubusercontent.com/profeangel96-bit/PLANTILLA/main/Gemini_Generated_Image_24c84124c84124c8.png" class="cover-logo">
            <div class="cover-title">INFORME GERENCIAL<br>DE CALIDAD EDUCATIVA</div>
            <div class="cover-strip"></div>
            <div class="cover-sub">EVALUACI√ìN ESTRAT√âGICA | SIMULACRO S-11</div>
        </div>
        <div class="cover-footer">
            DOCUMENTO OFICIAL GENERADO POR SISTEMA DE INTELIGENCIA QUIJANO<br>
            CONFIDENCIAL ‚Ä¢ PARA USO EXCLUSIVO DE ALCALD√çA Y RECTOR√çA
        </div>
    </div>

    <div class="page letter-page">
        <div class="letter-header">
            <div class="letter-title">Radicado N¬∞ <span id="rad-id">AQ-2026-001</span></div>
            <div style="text-align: right; font-size: 11px; color: #64748b;">
                <strong>EMISI√ìN CERTIFICADA:</strong><br><span id="date-gen">--/--/----</span>
            </div>
        </div>
        <div class="letter-body-container">
            <div class="letter-body">
                <p><strong>HONORABLE ALCALD√çA MUNICIPAL Y SECRETAR√çA DE EDUCACI√ìN:</strong></p>
                <p>En calidad de consultores externos especializados en medici√≥n y evaluaci√≥n educativa, la <strong>Academia Quijano</strong> hace entrega formal del presente dictamen t√©cnico.</p>
                <p>El siguiente informe no constituye un simple listado de calificaciones. Representa un an√°lisis de inteligencia de datos dise√±ado para identificar <strong>brechas de competencia</strong> espec√≠ficas, evaluar la dispersi√≥n de los resultados y proyectar el potencial de acceso a educaci√≥n superior p√∫blica.</p>
                <p>Se incorpora un an√°lisis de desviaci√≥n est√°ndar para determinar la homogeneidad del aprendizaje en el aula, as√≠ como una proyecci√≥n de percentiles nacionales.</p>
                <p>Quedamos a su entera disposici√≥n para la socializaci√≥n de estos hallazgos.</p>
            </div>
        </div>
        <div class="signature-block">
            <div class="sign-line"></div>
            <strong>JUAN √ÅNGEL RODR√çGUEZ BASANTE</strong><br>
            <span style="font-size: 11px; color: #64748b; font-weight: 500;">Director General de Operaciones<br>Sistema de Inteligencia Quijano</span>
        </div>
    </div>

    <div class="page matrix-page">
        <div class="section-title">Matriz Consolidada de Desempe√±o</div>

        <table class="data-table">
            <thead>
                <tr class="print-spacer"><th colspan="8"></th></tr>
                <tr>
                    <th style="width:30px;">#</th>
                    <th>Estudiante Evaluado</th>
                    <th style="width:50px;">LEC</th><th style="width:50px;">MAT</th><th style="width:50px;">SOC</th>
                    <th style="width:50px;">CIE</th><th style="width:50px;">ING</th><th style="width:60px;">GLOBAL</th>
                </tr>
            </thead>
            <tbody id="table-body">
                </tbody>
        </table>
        
        <div style="font-size: 9px; color: #64748b; text-align: center; margin-top: 10px;">
            * Convenci√≥n: Rojo (0-45) Cr√≠tico | Amarillo (46-65) Alerta | Verde (66-100) √ìptimo.
        </div>
    </div>

    <div class="page charts-page">
        <div class="section-title">Indicadores Visuales de Gesti√≥n</div>
        <div class="chart-box">
            <div class="chart-heading">Ranking de Desempe√±o Promedio por Asignatura</div>
            <div style="height: 250px;"><canvas id="barChart"></canvas></div>
        </div>
        <div class="chart-box" style="display: flex; flex-direction: column; align-items: center;">
            <div class="chart-heading">Distribuci√≥n Poblacional por Niveles</div>
            <div class="donut-simple-container">
                <canvas id="donutChart"></canvas>
                <div class="donut-center-txt">
                    <div style="font-size: 36px; font-weight: 900; color: var(--c-dark);" id="total-students">0</div>
                    <div style="font-size: 10px; color: #64748b; text-transform: uppercase; font-weight:700;">Estudiantes</div>
                </div>
            </div>
        </div>
    </div>

    <div class="page analysis-page">
        <div class="section-title">Dictamen T√©cnico Descriptivo Final</div>
        <div class="analysis-container">
            <div class="analysis-item bor-lec"><h3>1. Componente Lector y Comunicativo</h3><p class="analysis-text" id="desc-lec">El comportamiento del grupo en Lectura Cr√≠tica arroja un promedio de <span id="avg-lec-txt" style="font-weight:700">0</span>. Se observa que la competencia comunicativa se mantiene estable, sirviendo como base para el desempe√±o en otras √°reas.</p></div>
            <div class="analysis-item bor-mat"><h3>2. Razonamiento Cuantitativo</h3><p class="analysis-text" id="desc-mat">El √°rea de Matem√°ticas registra una media de <span id="avg-mat-txt" style="font-weight:700">0</span>. Los datos sugieren una dispersi√≥n en la resoluci√≥n de problemas, lo que impacta el puntaje global proyectado.</p></div>
            <div class="analysis-item bor-soc"><h3>3. Competencias Ciudadanas y Sociales</h3><p class="analysis-text" id="desc-soc">En Sociales y Ciudadanas, el promedio se ubica en <span id="avg-soc-txt" style="font-weight:700">0</span>. El grupo demuestra comprensi√≥n de fen√≥menos sociales b√°sicos, aunque se identifican oportunidades en el an√°lisis de multiperspectivismo.</p></div>
            <div class="analysis-item bor-cie"><h3>4. Pensamiento Cient√≠fico</h3><p class="analysis-text" id="desc-cie">Ciencias Naturales presenta un puntaje medio de <span id="avg-cie-txt" style="font-weight:700">0</span>. El an√°lisis de indagaci√≥n y uso comprensivo del conocimiento cient√≠fico muestra homogeneidad en el grupo evaluado.</p></div>
            <div class="analysis-item bor-ing"><h3>5. Competencia en Segunda Lengua</h3><p class="analysis-text" id="desc-ing">Ingl√©s cierra la evaluaci√≥n con un promedio de <span id="avg-ing-txt" style="font-weight:700">0</span>. La mayor√≠a de la poblaci√≥n se ubica en las bandas iniciales del Marco Com√∫n Europeo.</p></div>
        </div>
        <div class="legal-footer">CERTIFICADO DE AUTENTICIDAD DIGITAL ‚Ä¢ HASH: <span id="v-hash">---</span><br>SISTEMA DE GESTI√ìN DE CALIDAD QUIJANO V.71 FINAL</div>
    </div>

    <button class="fab-print" onclick="window.print()">üñ®Ô∏è IMPRIMIR INFORME</button>

    <script>
        // --- SIMULACI√ìN MASIVA (60 ALUMNOS) ---
        const base = [{ name: "AGUIRRE DAVILA DANA", l:71, m:68, s:70, c:75, i:80, g:364 },{ name: "ANACONA BOLA√ëOS ANDRES", l:65, m:45, s:60, c:55, i:45, g:270 },{ name: "BENAVIDES SOFIA", l:82, m:78, s:75, c:80, i:85, g:400 },{ name: "CAICEDO JUAN ESTEBAN", l:55, m:45, s:50, c:52, i:40, g:242 }];
        let students = []; for(let k=0; k<15; k++) students = students.concat(base.map(s => ({...s, name: s.name + " " + (k+1)})));

        // --- L√ìGICA TABLA ---
        const tbody = document.getElementById('table-body');
        let sum = {l:0,m:0,s:0,c:0,i:0,g:0};
        function color(v) { if(v<=45) return 'bg-crit'; if(v<=65) return 'bg-warn'; return 'bg-good'; }

        students.forEach((s,i) => {
            sum.l+=s.l; sum.m+=s.m; sum.s+=s.s; sum.c+=s.c; sum.i+=s.i; sum.g+=s.g;
            tbody.innerHTML += `<tr><td>${i+1}</td><td style="text-align:left; font-weight:600;">${s.name}</td><td><span class="${color(s.l)}">${s.l}</span></td><td><span class="${color(s.m)}">${s.m}</span></td><td><span class="${color(s.s)}">${s.s}</span></td><td><span class="${color(s.c)}">${s.c}</span></td><td><span class="${color(s.i)}">${s.i}</span></td><td><strong>${s.g}</strong></td></tr>`;
        });

        const c = students.length;
        const avg = {l:Math.round(sum.l/c), m:Math.round(sum.m/c), s:Math.round(sum.s/c), c:Math.round(sum.c/c), i:Math.round(sum.i/c), g:Math.round(sum.g/c)};
        tbody.innerHTML += `<tr class="final-row-total"><td colspan="2" style="text-align:right;">PROMEDIO INSTITUCIONAL:</td><td>${avg.l}</td><td>${avg.m}</td><td>${avg.s}</td><td>${avg.c}</td><td>${avg.i}</td><td>${avg.g}</td></tr>`;

        document.getElementById('total-students').innerText = c;
        document.getElementById('avg-lec-txt').innerText = avg.l;
        document.getElementById('avg-mat-txt').innerText = avg.m;
        document.getElementById('avg-soc-txt').innerText = avg.s;
        document.getElementById('avg-cie-txt').innerText = avg.c;
        document.getElementById('avg-ing-txt').innerText = avg.i;

        Chart.defaults.font.family = "'Inter', sans-serif";
        function getBarColor(val) { if(val<=60) return '#dc2626'; if(val<=75) return '#d97706'; return '#1d4ed8'; }
        new Chart(document.getElementById('barChart'), {
            type: 'bar', data: { labels: ['LECTURA', 'SOCIALES', 'CIENCIAS', 'INGL√âS', 'MATEM√ÅTICAS'], datasets: [{ data: [avg.l, avg.s, avg.c, avg.m, avg.i], backgroundColor: [getBarColor(avg.l), getBarColor(avg.s), getBarColor(avg.c), getBarColor(avg.m), getBarColor(avg.i)], borderRadius: 6, barPercentage: 0.6 }] },
            options: { indexAxis: 'y', plugins: { legend: false }, scales: { x: { beginAtZero:true, max:100 } } }
        });
        let levels = { low:0, mid:0, high:0 }; students.forEach(s=>{ if(s.g<250) levels.low++; else if(s.g<320) levels.mid++; else levels.high++; });
        new Chart(document.getElementById('donutChart'), {
            type: 'doughnut', data: { labels: ['Bajo (<250)', 'Medio (250-320)', 'Alto (>320)'], datasets: [{ data: [levels.low, levels.mid, levels.high], backgroundColor: ['#dc2626', '#f59e0b', '#16a34a'], borderWidth: 0 }] },
            options: { cutout: '70%', plugins: { legend: { position:'bottom', labels:{padding:25, usePointStyle:true, pointStyle:'circle', font:{size:12, weight:'600'}} } } }
        });

        const p = new URLSearchParams(window.location.search);
        if(p.get('rad')) document.getElementById('rad-id').innerText = p.get('rad');
        if(p.get('v')) document.getElementById('v-hash').innerText = p.get('v');
        document.getElementById('date-gen').innerText = new Date().toLocaleDateString('es-CO');
    </script>
</body>
</html>
