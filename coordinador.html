<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Informe Oficial | Academia Quijano</title>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --navy: #0f172a; --blue: #2563eb; --gold: #b45309;
            --risk-bg: #fecaca; --risk-txt: #991b1b;
            --warn-bg: #fef08a; --warn-txt: #854d0e;
            --safe-bg: #bbf7d0; --safe-txt: #166534;
            --white: #ffffff; --slate: #64748b;
        }

        body {
            font-family: 'Manrope', sans-serif;
            background: #cbd5e1;
            margin: 0;
            padding: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 40px;
        }

        /* --- CONFIGURACI√ìN DE P√ÅGINA F√çSICA --- */
        .sheet {
            background: white;
            width: 21cm; min-height: 29.7cm;
            padding: 0;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .content-padding { padding: 2cm; height: 100%; box-sizing: border-box; display: flex; flex-direction: column; }

        /* --- P√ÅGINA 1: PORTADA (IMPACTO VISUAL) --- */
        .cover-page {
            background: linear-gradient(160deg, #0f172a 0%, #1e293b 100%);
            color: white;
            justify-content: center;
            align-items: center;
            text-align: center;
            position: relative;
        }
        .cover-logo { width: 150px; margin-bottom: 40px; filter: drop-shadow(0 10px 20px rgba(0,0,0,0.5)); }
        .cover-title { font-size: 42px; font-weight: 800; letter-spacing: -1px; margin: 0; line-height: 1.1; }
        .cover-subtitle { font-size: 18px; color: #94a3b8; margin-top: 20px; font-weight: 300; letter-spacing: 2px; text-transform: uppercase; }
        .cover-divider { width: 80px; height: 6px; background: var(--gold); margin: 40px auto; border-radius: 3px; }
        .cover-footer { position: absolute; bottom: 2cm; font-size: 12px; opacity: 0.6; }

        /* --- P√ÅGINA 2: PRESENTACI√ìN ESTRAT√âGICA (DASHBOARD) --- */
        .header-strip { display: flex; justify-content: space-between; border-bottom: 2px solid #f1f5f9; padding-bottom: 20px; margin-bottom: 30px; }
        .brand h2 { margin: 0; color: var(--navy); font-weight: 800; font-size: 24px; }
        
        .ai-box {
            background: linear-gradient(135deg, #eff6ff 0%, #ffffff 100%);
            border-left: 5px solid var(--blue);
            padding: 25px; border-radius: 8px; margin-bottom: 30px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }
        .ai-title { color: var(--blue); font-weight: 800; font-size: 12px; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; display: flex; align-items: center; gap: 10px; }
        
        .grid-kpi { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px; }
        .kpi-card { background: white; border: 1px solid #e2e8f0; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
        .kpi-val { font-size: 36px; font-weight: 800; color: var(--navy); }
        .kpi-lbl { font-size: 10px; text-transform: uppercase; color: var(--slate); font-weight: 700; margin-top: 5px; }

        .chart-section { height: 350px; width: 100%; display: flex; justify-content: center; }

        /* --- P√ÅGINA 3: ACUMULADO POR MATERIA --- */
        .subject-row { display: grid; grid-template-columns: 150px 1fr 60px; align-items: center; gap: 20px; margin-bottom: 25px; }
        .subj-name { font-weight: 700; font-size: 14px; color: var(--navy); }
        .progress-track { background: #f1f5f9; height: 10px; border-radius: 5px; overflow: hidden; }
        .progress-fill { height: 100%; border-radius: 5px; transition: width 1s; }
        .subj-val { font-weight: 800; font-size: 16px; text-align: right; }

        /* --- P√ÅGINA 4: TABLA DE CALOR (HEATMAP) --- */
        .data-table { 
            width: 100%; border-collapse: collapse; font-size: 11px; 
            border: 1px solid #e2e8f0; 
        }
        .data-table thead { display: table-header-group; } /* REPETIR ENCABEZADO EN PDF */
        .data-table tr { page-break-inside: avoid; } /* NO CORTAR ALUMNOS */
        
        .data-table th { 
            background: var(--navy); color: white; text-align: left; 
            padding: 12px 8px; text-transform: uppercase; font-size: 9px; letter-spacing: 0.5px;
        }
        .data-table td { padding: 8px; border-bottom: 1px solid #e2e8f0; vertical-align: middle; }
        .data-table tr:nth-child(even) { background: #f8fafc; }

        /* Celdas de Calor */
        .heat-badge {
            display: block; width: 100%; text-align: center; padding: 4px 0; border-radius: 4px; font-weight: 700;
        }

        /* --- IMPRESI√ìN PRO --- */
        @media print {
            body { background: none; padding: 0; gap: 0; display: block; }
            .sheet { 
                width: 100%; height: auto; margin: 0; padding: 0; 
                box-shadow: none; border: none; 
                break-after: page; page-break-after: always;
            }
            .sheet:last-child { break-after: auto; }
            .cover-page { -webkit-print-color-adjust: exact; print-color-adjust: exact; height: 100vh; }
            .ai-box, .heat-badge, .kpi-card { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            .fab { display: none; }
        }

        .fab { position: fixed; bottom: 30px; right: 30px; background: var(--navy); color: white; padding: 15px 30px; border-radius: 50px; border: none; font-weight: 700; cursor: pointer; box-shadow: 0 20px 40px rgba(0,0,0,0.4); z-index: 100; transition: transform 0.2s;}
        .fab:hover { transform: scale(1.05); }
    </style>
</head>
<body>

    <div class="sheet cover-page">
        <div class="content-padding" style="justify-content: center;">
            <img src="https://raw.githubusercontent.com/profeangel96-bit/PLANTILLA/main/Gemini_Generated_Image_24c84124c84124c8.png" class="cover-logo">
            <h1 class="cover-title">INFORME DE<br>INTELIGENCIA ACAD√âMICA</h1>
            <div class="cover-divider"></div>
            <div class="cover-subtitle" id="cover-muni">MUNICIPIO</div>
            <div style="font-size: 14px; margin-top: 10px; color: #cbd5e1;" id="cover-sim">SIMULACRO S-11</div>
            
            <div class="cover-footer">
                DOCUMENTO CONFIDENCIAL ‚Ä¢ GENERADO POR SISTEMA QUIJANO<br>
                FECHA DE EMISI√ìN: <span id="date-display">16/01/2026</span>
            </div>
        </div>
    </div>

    <div class="sheet">
        <div class="content-padding">
            <div class="header-strip">
                <div class="brand"><h2>RESUMEN EJECUTIVO</h2></div>
                <div style="text-align: right; font-size: 11px; color: var(--slate);">ID: <span id="v-code">---</span></div>
            </div>

            <div class="ai-box">
                <div class="ai-title">‚ö° AN√ÅLISIS DE INTELIGENCIA ARTIFICIAL</div>
                <p style="margin: 0; font-size: 13px; line-height: 1.6; color: #334155;">
                    El an√°lisis de datos revela una tendencia de consolidaci√≥n en el n√∫cleo com√∫n. 
                    Se observa una <strong>oportunidad cr√≠tica en Ciencias Naturales</strong>, donde el 30% del grupo muestra brechas conceptuales. 
                    <br><br>
                    <strong>Recomendaci√≥n Directiva:</strong> Implementar talleres de profundizaci√≥n enfocados en indagaci√≥n cient√≠fica para movilizar al segmento medio hacia el nivel superior.
                </p>
            </div>

            <div class="grid-kpi">
                <div class="kpi-card">
                    <div class="kpi-val" id="kpi-avg">0</div>
                    <div class="kpi-lbl">Promedio Global</div>
                </div>
                <div class="kpi-card" style="border-bottom: 4px solid var(--safe-txt);">
                    <div class="kpi-val" style="color: var(--safe-txt);" id="kpi-exc">0%</div>
                    <div class="kpi-lbl">Excelencia Acad√©mica</div>
                </div>
                <div class="kpi-card" style="border-bottom: 4px solid var(--risk-txt);">
                    <div class="kpi-val" style="color: var(--risk-txt);" id="kpi-ini">0%</div>
                    <div class="kpi-lbl">Alerta de Riesgo</div>
                </div>
            </div>

            <div class="chart-section">
                <canvas id="radarChart"></canvas>
            </div>
        </div>
    </div>

    <div class="sheet">
        <div class="content-padding">
            <div class="header-strip">
                <div class="brand"><h2>CONSOLIDADO POR MATERIA</h2></div>
            </div>

            <p style="font-size: 12px; color: var(--slate); margin-bottom: 40px;">
                Desglose detallado del rendimiento promedio por √°rea de conocimiento frente a la meta institucional (70 puntos).
            </p>

            <div id="subjects-container">
                </div>

            <div style="margin-top: 50px; padding: 20px; background: #f8fafc; border-radius: 8px;">
                <h4 style="margin: 0 0 10px 0; font-size: 12px; color: var(--navy);">OBSERVACIONES GENERALES</h4>
                <ul style="font-size: 11px; color: var(--slate); padding-left: 20px; line-height: 1.8;">
                    <li>El √°rea de Ingl√©s muestra el crecimiento m√°s acelerado respecto a la medici√≥n anterior.</li>
                    <li>Matem√°ticas mantiene una desviaci√≥n est√°ndar alta, indicando desigualdad en el aprendizaje.</li>
                    <li>Lectura Cr√≠tica se consolida como la fortaleza institucional.</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="sheet">
        <div class="content-padding">
            <div class="header-strip">
                <div class="brand"><h2>MATRIZ DE CALOR (DETALLE)</h2></div>
            </div>

            <table class="data-table">
                <thead>
                    <tr>
                        <th style="width: 5%;">#</th>
                        <th style="width: 35%;">ESTUDIANTE</th>
                        <th style="width: 10%;">LEC</th>
                        <th style="width: 10%;">MAT</th>
                        <th style="width: 10%;">SOC</th>
                        <th style="width: 10%;">CIE</th>
                        <th style="width: 10%;">ING</th>
                        <th style="width: 10%;">GLOBAL</th>
                    </tr>
                </thead>
                <tbody id="student-table-body">
                    </tbody>
            </table>
            
            <div style="margin-top: auto; font-size: 10px; color: #cbd5e1; text-align: center;">
                FIN DEL REPORTE ‚Ä¢ ACADEMIA QUIJANO 2026
            </div>
        </div>
    </div>

    <button class="fab" onclick="window.print()">üñ®Ô∏è IMPRIMIR REPORTE (PDF)</button>

    <script>
        // --- 1. DATOS DE ENTRADA (SIMULACI√ìN H√çBRIDA) ---
        const p = new URLSearchParams(window.location.search);
        
        // Datos Reales de la URL
        const MUNI = (p.get('muni') || 'MUNICIPIO').toUpperCase();
        const SIM = p.get('sim') || 'SIMULACRO';
        const AVG = p.get('avg') || 0;
        
        // Asignar Textos
        document.getElementById('cover-muni').innerText = MUNI;
        document.getElementById('cover-sim').innerText = SIM;
        document.getElementById('v-code').innerText = p.get('v') || 'NO-AUTH';
        document.getElementById('kpi-avg').innerText = AVG;
        document.getElementById('kpi-exc').innerText = (p.get('exc')||0) + "%";
        document.getElementById('kpi-ini').innerText = (p.get('ini')||0) + "%";

        const scores = {
            lec: parseInt(p.get('lec')||65),
            mat: parseInt(p.get('mat')||55),
            soc: parseInt(p.get('soc')||60),
            cie: parseInt(p.get('cie')||58),
            ing: parseInt(p.get('ing')||62)
        };

        // --- 2. GENERADOR DE BARRAS DE MATERIA (P√ÅGINA 3) ---
        const subjContainer = document.getElementById('subjects-container');
        const subjects = [
            { id: 'lec', name: 'Lectura Cr√≠tica', val: scores.lec },
            { id: 'mat', name: 'Matem√°ticas', val: scores.mat },
            { id: 'soc', name: 'Sociales y Ciudadanas', val: scores.soc },
            { id: 'cie', name: 'Ciencias Naturales', val: scores.cie },
            { id: 'ing', name: 'Ingl√©s', val: scores.ing }
        ];

        subjects.forEach(s => {
            let color = '#2563eb'; // Blue default
            if(s.val < 60) color = '#ef4444'; // Red
            if(s.val > 70) color = '#10b981'; // Green

            const html = `
                <div class="subject-row">
                    <div class="subj-name">${s.name}</div>
                    <div class="progress-track">
                        <div class="progress-fill" style="width: ${s.val}%; background: ${color};"></div>
                    </div>
                    <div class="subj-val" style="color: ${color}">${s.val}</div>
                </div>
            `;
            subjContainer.innerHTML += html;
        });

        // --- 3. LOGICA DEL HEATMAP (P√ÅGINA 4) ---
        // Nota: Como la URL no puede traer 500 alumnos, aqu√≠ simulamos 
        // c√≥mo se ve la tabla con datos "dummy" para que apruebes el dise√±o.
        const tableBody = document.getElementById('student-table-body');
        
        // Funci√≥n para determinar color del Heatmap
        function getHeatClass(val) {
            if(val <= 35) return { bg: '#fecaca', txt: '#991b1b' }; // Cr√≠tico
            if(val <= 60) return { bg: '#fef08a', txt: '#854d0e' }; // Preventivo
            return { bg: '#bbf7d0', txt: '#166534' }; // √ìptimo
        }

        function createBadge(val) {
            const style = getHeatClass(val);
            return `<span class="heat-badge" style="background:${style.bg}; color:${style.txt}">${val}</span>`;
        }

        // Generamos 15 alumnos de ejemplo para visualizar el dise√±o
        const demoStudents = [
            "AGUIRRE DANA", "ANACONA ANDRES", "BENAVIDES SARA", "CAICEDO JUAN", "DIAZ PEDRO",
            "ESTRADA LUISA", "FERNANDEZ MARIA", "GOMEZ CARLOS", "HERNANDEZ SOFIA", "IGLESIAS TOMAS",
            "JIMENEZ PAULA", "LOPEZ DIEGO", "MARTINEZ ANA", "NARVAEZ JOSE", "ORTEGA LUIS"
        ];

        demoStudents.forEach((name, i) => {
            // Simulamos notas aleatorias cercanas al promedio para el demo
            const sLec = Math.floor(Math.random() * (80 - 40) + 40);
            const sMat = Math.floor(Math.random() * (80 - 30) + 30);
            const sSoc = Math.floor(Math.random() * (80 - 50) + 50);
            const sCie = Math.floor(Math.random() * (80 - 40) + 40);
            const sIng = Math.floor(Math.random() * (90 - 30) + 30);
            const sGlob = sLec+sMat+sSoc+sCie+sIng;

            const row = `
                <tr>
                    <td>${i+1}</td>
                    <td><strong>${name}</strong><br><span style="font-size:9px; color:#64748b;">ID: 1004...</span></td>
                    <td>${createBadge(sLec)}</td>
                    <td>${createBadge(sMat)}</td>
                    <td>${createBadge(sSoc)}</td>
                    <td>${createBadge(sCie)}</td>
                    <td>${createBadge(sIng)}</td>
                    <td><strong>${sGlob}</strong></td>
                </tr>
            `;
            tableBody.innerHTML += row;
        });

        // --- 4. RADAR CHART (P√ÅGINA 2) ---
        const ctx = document.getElementById('radarChart').getContext('2d');
        Chart.defaults.font.family = "'Manrope', sans-serif";
        new Chart(ctx, {
            type: 'radar',
            data: {
                labels: ['LECTURA', 'MATEM√ÅTICAS', 'SOCIALES', 'CIENCIAS', 'INGL√âS'],
                datasets: [{
                    label: 'Nivel Institucional',
                    data: [scores.lec, scores.mat, scores.soc, scores.cie, scores.ing],
                    backgroundColor: 'rgba(37, 99, 235, 0.2)',
                    borderColor: '#2563eb',
                    borderWidth: 2,
                    pointBackgroundColor: '#ffffff',
                    pointBorderColor: '#2563eb',
                    pointRadius: 4
                }]
            },
            options: {
                maintainAspectRatio: false,
                scales: {
                    r: {
                        beginAtZero: true, max: 100,
                        ticks: { display: false },
                        grid: { color: '#e2e8f0' },
                        angleLines: { color: '#e2e8f0' },
                        pointLabels: { font: { size: 11, weight: '700' }, color: '#475569' }
                    }
                },
                plugins: { legend: { display: false } }
            }
        });
    </script>
</body>
</html>
