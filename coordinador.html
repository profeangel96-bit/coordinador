<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Informe Gerencial de Calidad | Sistema Quijano</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>

    <style>
        :root {
            --c-dark: #0f172a;  /* Navy Premium */
            --c-blue: #1d4ed8;  /* Azul Institucional Fuerte */
            --c-gold: #b45309;  /* Dorado Serio */
            --c-gray: #f8fafc;
            --risk: #dc2626; --warn: #d97706; --safe: #16a34a;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #e2e8f0; /* Fondo de pantalla contrastante */
            margin: 0;
            padding: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 40px;
            color: var(--c-dark);
        }

        /* --- ARQUITECTURA A4 PREMIUM --- */
        .page {
            background: white;
            width: 21cm; height: 29.7cm; /* A4 Fijo */
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            overflow: hidden; /* Corte limpio */
        }

        /* Utilidad para llenar espacio verticalmente */
        .flex-grow { flex-grow: 1; } 

        /* --- P√ÅGINA 1: PORTADA (INTOCABLE) --- */
        .cover-page {
            background: linear-gradient(180deg, #0f172a 0%, #1e3a8a 70%, #1d4ed8 100%) !important;
            color: white;
            padding: 3cm;
            justify-content: center;
            text-align: center;
            -webkit-print-color-adjust: exact; print-color-adjust: exact;
        }
        .cover-logo { height: 140px; margin-bottom: 50px; filter: drop-shadow(0 10px 20px rgba(0,0,0,0.3)); }
        .cover-title { font-size: 48px; font-weight: 900; letter-spacing: -2px; line-height: 1; margin-bottom: 15px; }
        .cover-strip { width: 80px; height: 6px; background: var(--c-gold); margin: 0 auto 50px auto; border-radius: 3px; }
        .cover-sub { font-size: 18px; font-weight: 400; letter-spacing: 3px; text-transform: uppercase; opacity: 0.9; }
        .cover-footer { position: absolute; bottom: 2cm; left:0; right:0; font-size: 12px; opacity: 0.7; border-top: 1px solid rgba(255,255,255,0.2); padding-top: 20px; width: 80%; margin: auto; }

        /* --- P√ÅGINA 2: CARTA (CENTRADA Y FORMAL) --- */
        .letter-page { padding: 3cm 2.5cm; justify-content: space-between; }
        .letter-header { border-bottom: 3px solid var(--c-dark); padding-bottom: 20px; margin-bottom: 40px; }
        .letter-title { font-size: 22px; font-weight: 800; color: var(--c-blue); text-transform: uppercase; }
        
        /* Cuerpo de la carta centrado verticalmente */
        .letter-body-container { display: flex; flex-direction: column; justify-content: center; flex-grow: 1; }
        .letter-body { font-size: 14px; line-height: 2; text-align: justify; color: #334155; }
        .letter-body p { margin-bottom: 25px; }

        .signature-block { margin-top: auto; } /* Empuja hacia abajo */
        .sign-line { width: 250px; border-bottom: 2px solid #0f172a; margin-bottom: 15px; }

        /* --- P√ÅGINA 3: MATRIZ (RELLENITA) --- */
        .matrix-page { padding: 2cm; }
        .section-title { font-size: 20px; font-weight: 800; color: var(--c-dark); border-left: 6px solid var(--c-blue); padding-left: 15px; margin-bottom: 30px; text-transform: uppercase; }

        .table-container { flex-grow: 1; display: flex; flex-direction: column; }
        .data-table { width: 100%; border-collapse: collapse; font-size: 11px; height: 100%; }
        .data-table th { background: var(--c-dark); color: white; padding: 12px; text-transform: uppercase; letter-spacing: 1px; }
        /* Celdas m√°s altas para llenar espacio */
        .data-table td { padding: 10px 8px; border-bottom: 1px solid #e2e8f0; text-align: center; vertical-align: middle; }
        .data-table tr:nth-child(even) { background: #f8fafc; }
        .col-name { text-align: left !important; font-weight: 700; font-size: 12px; }
        
        .row-total td { background: #e2e8f0; font-weight: 900; border-top: 3px solid var(--c-dark); font-size: 13px; padding: 15px 8px; }
        
        /* Colores Heatmap */
        .bg-crit { background: #fee2e2; color: var(--risk); font-weight:700; border-radius: 4px; padding: 4px 8px; }
        .bg-warn { background: #fef3c7; color: var(--warn); font-weight:700; border-radius: 4px; padding: 4px 8px; }
        .bg-good { background: #dcfce7; color: var(--safe); font-weight:700; border-radius: 4px; padding: 4px 8px; }

        /* --- P√ÅGINA 4: GR√ÅFICAS (IMPONENTES Y 3D) --- */
        .charts-page { padding: 2cm; }
        .charts-container { flex-grow: 1; display: flex; flex-direction: column; gap: 40px; justify-content: center; }
        
        .chart-box { 
            background: white; border-radius: 16px; padding: 25px; 
            box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.08); border: 1px solid #f1f5f9;
        }
        .chart-heading { text-align: center; font-weight: 800; margin-bottom: 20px; color: var(--c-blue); text-transform: uppercase; font-size: 14px; }

        /* Donut 3D Profundo */
        .donut-wrapper { 
            position: relative; height: 300px; display: flex; justify-content: center; align-items: center;
            /* Sombra interna para efecto 3D */
            border-radius: 50%;
            box-shadow: inset 0 0 30px rgba(0,0,0,0.1), 0 20px 40px rgba(0,0,0,0.2);
            width: 300px; margin: 0 auto; background: white; padding: 10px;
        }
        .donut-center-txt { 
            position: absolute; text-align: center; top: 50%; left: 50%; transform: translate(-50%, -50%);
        }

        /* --- P√ÅGINA 5: DICTAMEN (ESPACIADO) --- */
        .analysis-page { padding: 2cm; justify-content: space-between; }
        .analysis-container { flex-grow: 1; display: flex; flex-direction: column; justify-content: space-evenly; /* Distribuye el espacio */ }
        
        .analysis-item { 
            background: #f8fafc; border-left: 6px solid var(--c-gold); 
            padding: 25px; border-radius: 0 12px 12px 0; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.03);
        }
        .analysis-item h3 { margin: 0 0 15px 0; font-size: 15px; color: var(--c-dark); text-transform: uppercase; font-weight: 800; }
        .analysis-text { font-size: 13px; line-height: 1.8; color: #475569; text-align: justify; margin: 0; }

        .footer-strip { text-align: center; font-size: 11px; color: #94a3b8; border-top: 1px solid #e2e8f0; padding-top: 20px; }

        /* --- IMPRESI√ìN PERFECTA --- */
        @media print {
            @page { margin: 0; size: A4; } /* M√°rgenes cero es CLAVE para la portada */
            body { background: white; padding: 0; gap: 0; }
            .page { 
                margin: 0; width: 21cm; height: 29.7cm; 
                box-shadow: none; page-break-after: always; break-inside: avoid;
            }
            .page:last-child { page-break-after: auto; }
            .fab-print { display: none; }
            /* Forzar fondos exactos */
            * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
        }

        .fab-print { position: fixed; bottom: 30px; right: 30px; background: var(--c-blue); color: white; padding: 15px 40px; border-radius: 50px; font-weight: 800; cursor: pointer; border: none; box-shadow: 0 10px 25px rgba(29, 78, 216, 0.5); z-index: 999; font-size: 14px; }
    </style>
</head>
<body>

    <div class="page cover-page">
        <div>
            <img src="https://raw.githubusercontent.com/profeangel96-bit/PLANTILLA/main/Gemini_Generated_Image_24c84124c84124c8.png" class="cover-logo">
            <div class="cover-title">INFORME GERENCIAL<br>DE CALIDAD EDUCATIVA</div>
            <div class="cover-strip"></div>
            <div class="cover-sub">EVALUACI√ìN ESTRAT√âGICA | SIMULACRO S-11</div>
        </div>
        <div class="cover-footer">
            DOCUMENTO OFICIAL GENERADO POR SISTEMA DE INTELIGENCIA QUIJANO<br>
            CONFIDENCIAL ‚Ä¢ PARA USO EXCLUSIVO DE ALCALD√çA Y RECTOR√çA
        </div>
    </div>

    <div class="page letter-page">
        <div class="letter-header">
            <div class="letter-title">Radicado N¬∞ <span id="rad-id">AQ-2026-001</span></div>
            <div style="text-align: right; font-size: 12px; color: #64748b;">
                <strong>FECHA DE EMISI√ìN:</strong><br>16 de Enero de 2026
            </div>
        </div>
        
        <div class="letter-body-container">
            <div class="letter-body">
                <p><strong>HONORABLE ALCALD√çA MUNICIPAL Y SECRETAR√çA DE EDUCACI√ìN:</strong></p>
                <p>
                    En calidad de consultores externos especializados en medici√≥n y evaluaci√≥n educativa, 
                    la <strong>Academia Quijano</strong> hace entrega formal del presente dictamen t√©cnico 
                    correspondiente a la prueba diagn√≥stica (Simulacro S-11) aplicada a la poblaci√≥n de grado und√©cimo.
                </p>
                <p>
                    El siguiente informe no constituye un simple listado de calificaciones. Representa un an√°lisis 
                    de inteligencia de datos dise√±ado para identificar brechas de aprendizaje estructurales, 
                    evaluar la eficacia de los procesos docentes actuales y proporcionar una hoja de ruta 
                    basada en evidencia cuantitativa para la toma de decisiones directivas.
                </p>
                <p>
                    Los resultados se presentan desglosados en matriz de desempe√±o, an√°lisis gr√°fico de √°reas 
                    y dictamen descriptivo final.
                </p>
                <p>Quedamos a su entera disposici√≥n para la socializaci√≥n de estos hallazgos.</p>
            </div>
        </div>

        <div class="signature-block">
            <div class="sign-line"></div>
            <strong>JUAN √ÅNGEL RODR√çGUEZ BASANTE</strong><br>
            <span style="font-size: 12px; color: #64748b; font-weight: 500;">Director General de Operaciones<br>Sistema de Inteligencia Quijano</span>
        </div>
    </div>

    <div class="page matrix-page">
        <div class="section-title">Matriz Consolidada de Desempe√±o (Heatmap)</div>

        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th style="width: 40px;">#</th>
                        <th>Estudiante Evaluado</th>
                        <th style="width: 70px;">LEC</th>
                        <th style="width: 70px;">MAT</th>
                        <th style="width: 70px;">SOC</th>
                        <th style="width: 70px;">CIE</th>
                        <th style="width: 70px;">ING</th>
                        <th style="width: 80px;">GLOBAL</th>
                    </tr>
                </thead>
                <tbody id="table-body">
                    </tbody>
                <tfoot>
                    <tr class="row-total" id="table-footer">
                        </tr>
                </tfoot>
            </table>
        </div>
        
        <div style="margin-top: 15px; font-size: 10px; color: #64748b;">
            * Convenci√≥n Heatmap: <span class="bg-crit" style="font-size:9px;">0-45 Cr√≠tico</span> | <span class="bg-warn" style="font-size:9px;">46-65 Alerta</span> | <span class="bg-good" style="font-size:9px;">66-100 √ìptimo</span>.
        </div>
    </div>

    <div class="page charts-page">
        <div class="section-title">Indicadores Visuales de Gesti√≥n Acad√©mica</div>

        <div class="charts-container">
            <div class="chart-box">
                <div class="chart-heading">Ranking de Desempe√±o Promedio por Asignatura</div>
                <div style="height: 280px;"> <canvas id="barChart"></canvas>
                </div>
            </div>

            <div class="chart-box" style="display: flex; flex-direction: column; align-items: center;">
                <div class="chart-heading">Distribuci√≥n Poblacional por Niveles de Competencia</div>
                <div class="donut-wrapper">
                    <canvas id="donutChart"></canvas>
                    <div class="donut-center-txt">
                        <div style="font-size: 36px; font-weight: 900; color: var(--c-dark);" id="total-students">0</div>
                        <div style="font-size: 11px; color: #64748b; text-transform: uppercase;">Estudiantes</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="page analysis-page">
        <div class="section-title">Dictamen T√©cnico Descriptivo Final</div>

        <div class="analysis-container">
            <div class="analysis-item">
                <h3>1. Hallazgos en Componente Lector y Comunicativo</h3>
                <p class="analysis-text" id="desc-lec">
                    El an√°lisis de los datos evidencia que la media aritm√©tica del grupo en Lectura Cr√≠tica se sit√∫a en <span id="avg-lec-txt" style="font-weight:700">0</span> puntos. 
                    Se observa una dispersi√≥n moderada en los resultados, lo que sugiere niveles heterog√©neos de apropiaci√≥n de la competencia inferencial.
                </p>
            </div>

            <div class="analysis-item">
                <h3>2. Hallazgos en Razonamiento Cuantitativo y Cient√≠fico</h3>
                <p class="analysis-text" id="desc-mat">
                    Las √°reas de Matem√°ticas y Ciencias Naturales presentan los mayores retos del ciclo evaluado. 
                    El promedio de Matem√°ticas (<span id="avg-mat-txt" style="font-weight:700; color:var(--risk);">0</span>) indica una tendencia hacia el rango inferior, 
                    requiriendo una revisi√≥n de las estrategias de fortalecimiento en resoluci√≥n de problemas.
                </p>
            </div>

            <div class="analysis-item">
                <h3>3. Desempe√±o en Segunda Lengua (Ingl√©s)</h3>
                <p class="analysis-text" id="desc-ing">
                    El componente de Ingl√©s muestra un comportamiento estable dentro de la banda media de desempe√±o, 
                    con un promedio consolidado de <span id="avg-ing-txt" style="font-weight:700">0</span>. 
                    La mayor√≠a de la poblaci√≥n evaluada demuestra dominio de las competencias b√°sicas del marco de referencia.
                </p>
            </div>
        </div>

        <div class="footer-strip">
            INFORME GENERADO BAJO EST√ÅNDARES DE CALIDAD ISO ‚Ä¢ SISTEMA QUIJANO V.63
        </div>
    </div>

    <button class="fab-print" onclick="window.print()">üñ®Ô∏è IMPRIMIR INFORME OFICIAL</button>

    <script>
        // --- DATOS SIMULADOS (SE LLENAR√ÅN 15 PARA LLENAR LA HOJA) ---
        const baseStudents = [
            { name: "AGUIRRE DAVILA DANA", l: 71, m: 68, s: 70, c: 75, i: 80, g: 364 },
            { name: "ANACONA BOLA√ëOS ANDRES", l: 65, m: 50, s: 60, c: 55, i: 45, g: 275 },
            { name: "ARCOS NANDAR OSCAR", l: 40, m: 30, s: 45, c: 50, i: 35, g: 200 },
            { name: "BENAVIDES SOFIA", l: 82, m: 78, s: 75, c: 80, i: 85, g: 400 },
            { name: "CAICEDO JUAN ESTEBAN", l: 55, m: 45, s: 50, c: 52, i: 40, g: 242 }
        ];
        // Triplicamos para tener 15 alumnos y llenar la tabla
        let students = [...baseStudents, ...baseStudents, ...baseStudents].map((s, i) => ({...s, name: s.name + (i>4 ? " " + (i+1) : "")}));

        // --- L√ìGICA TABLA Y TOTALES ---
        const tbody = document.getElementById('table-body');
        let sum = { l:0, m:0, s:0, c:0, i:0, g:0 };
        function getColor(v) { if(v<=45) return 'bg-crit'; if(v<=65) return 'bg-warn'; return 'bg-good'; }

        students.forEach((s, i) => {
            sum.l+=s.l; sum.m+=s.m; sum.s+=s.s; sum.c+=s.c; sum.i+=s.i; sum.g+=s.g;
            tbody.innerHTML += `<tr>
                <td>${i+1}</td><td class="col-name">${s.name}</td>
                <td><span class="${getColor(s.l)}">${s.l}</span></td><td><span class="${getColor(s.m)}">${s.m}</span></td>
                <td><span class="${getColor(s.s)}">${s.s}</span></td><td><span class="${getColor(s.c)}">${s.c}</span></td>
                <td><span class="${getColor(s.i)}">${s.i}</span></td><td><strong>${s.g}</strong></td>
            </tr>`;
        });

        const count = students.length;
        const avg = { l:Math.round(sum.l/count), m:Math.round(sum.m/count), s:Math.round(sum.s/count), c:Math.round(sum.c/count), i:Math.round(sum.i/count), g:Math.round(sum.g/count) };

        document.getElementById('table-footer').innerHTML = `
            <td colspan="2" style="text-align:right; letter-spacing:1px;">PROMEDIO INSTITUCIONAL:</td>
            <td class="${getColor(avg.l)}">${avg.l}</td><td class="${getColor(avg.m)}">${avg.m}</td>
            <td class="${getColor(avg.s)}">${avg.s}</td><td class="${getColor(avg.c)}">${avg.c}</td>
            <td class="${getColor(avg.i)}">${avg.i}</td><td style="font-size:14px;">${avg.g}</td>
        `;

        // Actualizar Textos
        document.getElementById('total-students').innerText = count;
        document.getElementById('avg-lec-txt').innerText = avg.l;
        document.getElementById('avg-mat-txt').innerText = avg.m;
        document.getElementById('avg-ing-txt').innerText = avg.i;

        // --- GR√ÅFICOS ---
        Chart.defaults.font.family = "'Inter', sans-serif";
        
        // 1. Barras Imponentes
        new Chart(document.getElementById('barChart'), {
            type: 'bar',
            data: {
                labels: ['LECTURA', 'SOCIALES', 'CIENCIAS', 'INGL√âS', 'MATEM√ÅTICAS'],
                datasets: [{
                    data: [avg.l, avg.s, avg.c, avg.i, avg.m],
                    backgroundColor: ['#1d4ed8', '#1d4ed8', '#b45309', '#b45309', '#dc2626'],
                    borderRadius: 6, barPercentage: 0.7
                }]
            },
            options: {
                indexAxis: 'y', plugins: { legend: false },
                scales: { x: { beginAtZero:true, max:100, grid:{color:'#e2e8f0'} }, y: { grid:{display:false}, ticks:{font:{weight:'700'}} } }
            }
        });

        // 2. Donut 3D Profundo
        let levels = { low:0, mid:0, high:0 }; students.forEach(s=>{ if(s.g<250) levels.low++; else if(s.g<320) levels.mid++; else levels.high++; });
        new Chart(document.getElementById('donutChart'), {
            type: 'doughnut',
            data: {
                labels: ['Bajo', 'Medio', 'Alto'],
                datasets: [{
                    data: [levels.low, levels.mid, levels.high],
                    backgroundColor: ['#dc2626', '#f59e0b', '#16a34a'],
                    borderWidth: 4, borderColor: '#ffffff', hoverOffset: 15
                }]
            },
            options: { cutout: '75%', plugins: { legend: { position:'bottom', labels:{padding:20, usePointStyle:true} } } }
        });

        const p = new URLSearchParams(window.location.search);
        if(p.get('rad')) document.getElementById('rad-id').innerText = p.get('rad');
    </script>
</body>
</html>
